name: AHM flow (all steps)

on:
  workflow_dispatch:
    inputs:
      sudo-key:
        description: "Sudo key to use as override (optional, default is //Alice)"
        required: false
      network:
        description: "Network to use (ALL means Polkadot and Kusama)"
        default: "polkadot"
        type: choice
        options:
          - ALL
          - kusama
          - polkadot
      rc_runtime_override_url:
        description: "Url to download the RC runtime to override (e.g https://some-server.com/kusama_runtime-v1009000.compact.compressed_processed.wasm)"
        required: false
        type: string
        default: ""
      ah_runtime_override_url:
        description: "Url to download the AH runtime to override (e.g https://some-server.com/asset-hub-kusama_runtime-v1009000.compact.compressed_processed.wasm)"
        required: false
        type: string
        default: ""
  schedule:
    - cron: "0 0 * * *" # Every Day for Polkadot

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

permissions: {}

jobs:
  zombie_bite_polkadot:
    # run by schedule or by demand
    if: ${{ inputs.network == 'ALL' || inputs.network == 'polkadot' || github.event.schedule == '0 0 * * *' }}
    uses: ./.github/workflows/zombie-bite-common.yml
    with:
      network: polkadot
      sudo-key: ${{ inputs.sudo-key }}
      rc_runtime_override_url: ${{ inputs.rc_runtime_override_url }}
      ah_runtime_override_url: ${{ inputs.ah_runtime_override_url }}
      runner: parity-zombienet-native-large
      doppelganger_version: doppelganger-stable2509 # use latest release of polkadot

  zombie_bite_kusama:
    # run by demand
    if: ${{ inputs.network == 'ALL' || inputs.network == 'kusama' }}
    uses: ./.github/workflows/zombie-bite-common.yml
    with:
      network: kusama
      sudo-key: ${{ inputs.sudo-key }}
      rc_runtime_override_url: ${{ inputs.rc_runtime_override_url }}
      ah_runtime_override_url: ${{ inputs.ah_runtime_override_url }}
      runner: parity-large-persistent

